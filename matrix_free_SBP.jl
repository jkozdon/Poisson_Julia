using StaticArrays
struct D2{ORDER, T, HBT, VMBT, VMIT, BST}
  HBI::HBT
  VMB::VMBT
  VMI::VMIT
  BS::BST
  function D2{4, T}() where T
    BS = SVector{4, T}(11//6, -3//1, 3//2, -1//3)
    HBI = SVector{4, T}(48//17, 48//59, 48//43, 48//49)
    VMB = zeros(T, 21, 8)
    VMB[ 1, [1, 2, 3, 4]]       .=  ( (12//17), (59//192), (27010400129//345067064608), (69462376031//2070402387648))
    VMB[ 2, [1, 3, 4]]          .=  (-(59//68), -(6025413881//21126554976), -(537416663//7042184992))
    VMB[ 3, [1, 2, 4, 3]]       .=  ( (2//17), -(59//192), (213318005//16049630912), (2083938599//8024815456))
    VMB[ 4, [1, 3, 4]]          .=  ( (3//68), -(1244724001//21126554976), (752806667//21126554976))
    VMB[ 5, [3, 4]]             .=  ( (49579087//10149031312), -(49579087//10149031312))
    VMB[ 6, [4, 3]]             .=  (-(1//784), (1//784))
    VMB[ 7, [1, 3, 4]]          .=  ( (3481//3264), (9258282831623875//7669235228057664), (236024329996203//1278205871342944))
    VMB[ 8, [1, 3, 4]]          .=  (-(59//408), -(29294615794607//29725717938208), -(2944673881023//29725717938208))
    VMB[ 9, [1, 3, 4]]          .=  (-(59//1088), (260297319232891//2556411742685888), -(60834186813841//1278205871342944))
    VMB[10, [3, 4]]             .=  (-(1328188692663//37594290333616), (1328188692663//37594290333616))
    VMB[11, [3, 4]]             .=  (-(8673//2904112), (8673//2904112))
    VMB[12, [1, 2, 4, 5, 3]]    .=  ( (1//51), (59//192), (13777050223300597//26218083221499456), (564461//13384296), (378288882302546512209//270764341349677687456))
    VMB[13, [1, 5, 3, 4]]       .=  ( (1//136), -(125059//743572), -(4836340090442187227//5525802884687299744), -(17220493277981//89177153814624))
    VMB[14, [4, 3, 5]]          .=  (-(10532412077335//42840005263888), (1613976761032884305//7963657098519931984), (564461//4461432))
    VMB[15, [4, 5, 3]]          .=  (-(960119//1280713392), -(3391//6692148), (33235054191//26452850508784))
    VMB[16, [1, 3, 5, 6, 4]]    .=  ( (3//1088), (507284006600757858213//475219048083107777984), (1869103//2230716), (1//24), (1950062198436997//3834617614028832))
    VMB[17, [3, 6, 4, 5]]       .=  (-(4959271814984644613//20965546238960637264), -(1//6), -(15998714909649//37594290333616), -(375177//743572))
    VMB[18, [5, 3, 4, 6]]       .=  (-(368395//2230716), (752806667//539854092016), (1063649//8712336), (1//8))
    VMB[19, [3, 4, 6, 7, 5]]    .=  ( (8386761355510099813//128413970713633903242), (2224717261773437//2763180339520776), (5//6), (1//24), (280535//371786))
    VMB[20, [4, 7, 3, 5, 6]]    .=  (-(35039615//213452232), -(1//6), -(13091810925//13226425254392), -(1118749//2230716), -(1//2))
    VMB[21, [4, 5, 7, 8, 3, 6]] .=  ( (3290636//80044587), (5580181//6692148), (5//6), (1//24), (660204843//13226425254392), (3//4))
    VMB = SMatrix{21, 8, T}(VMB)
    # TODO: VMI
  end
end


#=
function variable_diagonal_sbp_D2(p, N, B::Array{Float64,1}; xc = (-1, 1))
  @assert length(B) == N+1

  if p == 2
    bhinv = [2];

    I_M0 = [1]
    J_M0 = [1]
    V_M0 = [(B[1]+B[2])/2]

    I_MN = [N+1]
    J_MN = [N+1]
    V_MN = [(B[N]+B[N+1])/2]

    I_M = [2:N+1;
           2:N  ;
           1:N  ]
    J_M = [1:N  ;
           2:N  ;
           2:N+1]
    V_M = [-(B[1:N  ]+B[2:N+1])/2;
            (B[1:N-1]+2B[2:N]+B[3:N+1])/2;
           -(B[1:N  ]+B[2:N+1])/2];
    M = sparse([I_M0;I_M;I_MN], [J_M0;J_M;J_MN], [V_M0;V_M;V_MN])

    BS = [3/2 -2 1/2];
  elseif p == 4
    bhinv = [48/17 48/59 48/43 48/49];

    BS = [11/6 -3 3/2 -1/3];

    V_M0 = zeros(6,6)

    (b1,b2,b3,b4,b5,b6,b7,b8) = B[1:8]
    V_M0[1, 1] =                (12/17)b1 + (59/192)b2 + (27010400129/345067064608)b3 + (69462376031/2070402387648)b4
    V_M0[1, 2] = V_M0[2, 1] = - (59/68)b1 - (6025413881/21126554976)b3 - (537416663/7042184992)b4
    V_M0[1, 3] = V_M0[3, 1] =   (2/17)b1 - (59/192)b2 + (213318005/16049630912)b4 + (2083938599/8024815456)b3
    V_M0[1, 4] = V_M0[4, 1] =   (3/68)b1 - (1244724001/21126554976)b3 + (752806667/21126554976)b4
    V_M0[1, 5] = V_M0[5, 1] =   (49579087/10149031312)b3 - (49579087/10149031312)b4
    V_M0[1, 6] = V_M0[6, 1] = - (1/784)b4 + (1/784)b3
    V_M0[2, 2] =                (3481/3264)b1 + (9258282831623875/7669235228057664)b3 + (236024329996203/1278205871342944)b4
    V_M0[2, 3] = V_M0[3, 2] = - (59/408)b1 - (29294615794607/29725717938208)b3 - (2944673881023/29725717938208)b4
    V_M0[2, 4] = V_M0[4, 2] = - (59/1088)b1 + (260297319232891/2556411742685888)b3 - (60834186813841/1278205871342944)b4
    V_M0[2, 5] = V_M0[5, 2] = - (1328188692663/37594290333616)b3 + (1328188692663/37594290333616)b4
    V_M0[2, 6] = V_M0[6, 2] = - (8673/2904112)b3 + (8673/2904112)b4
    V_M0[3, 3] =                (1/51)b1 + (59/192)b2 + (13777050223300597/26218083221499456)b4 + (564461/13384296)b5 + (378288882302546512209/270764341349677687456)b3
    V_M0[3, 4] = V_M0[4, 3] =   (1/136)b1 - (125059/743572)b5 - (4836340090442187227/5525802884687299744)b3 - (17220493277981/89177153814624)b4
    V_M0[3, 5] = V_M0[5, 3] = - (10532412077335/42840005263888)b4 + (1613976761032884305/7963657098519931984)b3 + (564461/4461432)b5
    V_M0[3, 6] = V_M0[6, 3] = - (960119/1280713392)b4 - (3391/6692148)b5 + (33235054191/26452850508784)b3
    V_M0[4, 4] =                (3/1088)b1 + (507284006600757858213/475219048083107777984)b3 + (1869103/2230716)b5 + (1/24)b6 + (1950062198436997/3834617614028832)b4
    V_M0[4, 5] = V_M0[5, 4] = - (4959271814984644613/20965546238960637264)b3 - (1/6)b6 - (15998714909649/37594290333616)b4 - (375177/743572)b5
    V_M0[4, 6] = V_M0[6, 4] = - (368395/2230716)b5 + (752806667/539854092016)b3 + (1063649/8712336)b4 + (1/8)b6
    V_M0[5, 5] =                (8386761355510099813/128413970713633903242)b3 + (2224717261773437/2763180339520776)b4 + (5/6)b6 + (1/24)b7 + (280535/371786)b5
    V_M0[5, 6] = V_M0[6, 5] = - (35039615/213452232)b4 - (1/6)b7 - (13091810925/13226425254392)b3 - (1118749/2230716)b5 - (1/2)b6
    V_M0[6, 6] =                (3290636/80044587)b4 + (5580181/6692148)b5 + (5/6)b7 + (1/24)b8 + (660204843/13226425254392)b3 + (3/4)b6
    I_M0 = (1:6) * ones(1,6)
    J_M0 = I_M0'

    V_MN = zeros(6,6)
    (b1,b2,b3,b4,b5,b6,b7,b8) = B[N+1:-1:N-6]
    V_MN[6, 6] =                (12/17)b1 + (59/192)b2 + (27010400129/345067064608)b3 + (69462376031/2070402387648)b4
    V_MN[6, 5] = V_MN[5, 6] = - (59/68)b1 - (6025413881/21126554976)b3 - (537416663/7042184992)b4
    V_MN[6, 4] = V_MN[4, 6] =   (2/17)b1 - (59/192)b2 + (213318005/16049630912)b4 + (2083938599/8024815456)b3
    V_MN[6, 3] = V_MN[3, 6] =   (3/68)b1 - (1244724001/21126554976)b3 + (752806667/21126554976)b4
    V_MN[6, 2] = V_MN[2, 6] =   (49579087/10149031312)b3 - (49579087/10149031312)b4
    V_MN[6, 1] = V_MN[1, 6] = - (1/784)b4 + (1/784)b3
    V_MN[5, 5] =                (3481/3264)b1 + (9258282831623875/7669235228057664)b3 + (236024329996203/1278205871342944)b4
    V_MN[5, 4] = V_MN[4, 5] = - (59/408)b1 - (29294615794607/29725717938208)b3 - (2944673881023/29725717938208)b4
    V_MN[5, 3] = V_MN[3, 5] = - (59/1088)b1 + (260297319232891/2556411742685888)b3 - (60834186813841/1278205871342944)b4
    V_MN[5, 2] = V_MN[2, 5] = - (1328188692663/37594290333616)b3 + (1328188692663/37594290333616)b4
    V_MN[5, 1] = V_MN[1, 5] = - (8673/2904112)b3 + (8673/2904112)b4
    V_MN[4, 4] =                (1/51)b1 + (59/192)b2 + (13777050223300597/26218083221499456)b4 + (564461/13384296)b5 + (378288882302546512209/270764341349677687456)b3
    V_MN[4, 3] = V_MN[3, 4] =   (1/136)b1 - (125059/743572)b5 - (4836340090442187227/5525802884687299744)b3 - (17220493277981/89177153814624)b4
    V_MN[4, 2] = V_MN[2, 4] = - (10532412077335/42840005263888)b4 + (1613976761032884305/7963657098519931984)b3 + (564461/4461432)b5
    V_MN[4, 1] = V_MN[1, 4] = - (960119/1280713392)b4 - (3391/6692148)b5 + (33235054191/26452850508784)b3
    V_MN[3, 3] =                (3/1088)b1 + (507284006600757858213/475219048083107777984)b3 + (1869103/2230716)b5 + (1/24)b6 + (1950062198436997/3834617614028832)b4
    V_MN[3, 2] = V_MN[2, 3] = - (4959271814984644613/20965546238960637264)b3 - (1/6)b6 - (15998714909649/37594290333616)b4 - (375177/743572)b5
    V_MN[3, 1] = V_MN[1, 3] = - (368395/2230716)b5 + (752806667/539854092016)b3 + (1063649/8712336)b4 + (1/8)b6
    V_MN[2, 2] =                (8386761355510099813/128413970713633903242)b3 + (2224717261773437/2763180339520776)b4 + (5/6)b6 + (1/24)b7 + (280535/371786)b5
    V_MN[2, 1] = V_MN[1, 2] = - (35039615/213452232)b4 - (1/6)b7 - (13091810925/13226425254392)b3 - (1118749/2230716)b5 - (1/2)b6
    V_MN[1, 1] =                (3290636/80044587)b4 + (5580181/6692148)b5 + (5/6)b7 + (1/24)b8 + (660204843/13226425254392)b3 + (3/4)b6

    I_MN = (N-4:N+1) * ones(1,6)
    J_MN = I_MN'

    I_M = [7:N-3;
           7:N-4;
           7:N-5;
           6:N-5;
           5:N-5]
    J_M = [5:N-5;
           6:N-5;
           7:N-5;
           7:N-4;
           7:N-3]
    V_M = [(+(1/8)B[(5:N-5).+2] - (1/6)B[(5:N-5).+1] + (1/8)B[(5:N-5)]);
           (-(1/6)B[(6:N-5).+2] - (1/2)B[(6:N-5).+1] - (1/2)B[(6:N-5)] - (1/6)B[(6:N-5).-1]);
           (+(1/24)B[(7:N-5).+2] + (5/6)B[(7:N-5).+1] + (3/4)B[(7:N-5)] + (5/6)B[(7:N-5).-1] + (1/24)B[(7:N-5).-2]);
           (-(1/6)B[(7:N-4).+1] - (1/2)B[(7:N-4)] - (1/2)B[(7:N-4).-1] - (1/6)B[(7:N-4).-2]);
           (+(1/8)B[(7:N-3)] -(1/6)B[(7:N-3).-1] +(1/8)B[(7:N-3).-2]);
          ]

    M = sparse([I_M0[:];I_M;I_MN[:]], [J_M0[:];J_M;J_MN[:]],
               [V_M0[:];V_M;V_MN[:]])

  elseif p == 6

    bhinv = [43200/13649 8640/12013 4320/2711 4320/5359 8640/7877 43200/43801];

    BS = [25/12 -4 3 -4/3 1/4];

    V_M0 = zeros(9,9)

    (b1,b2,b3,b4,b5,b6,b7,b8,b9,b10,b11,b12) = B[1:12]
    V_M0[1, 1] = 0.79126675946955820939b1 + 0.29684720906380007429b2 + 0.0031855190887964290152b3 + 0.016324040425909519534b4 + 0.031603022440944150877b5 + 0.031679647480161052996b6 + 0.031485777339472539205b7
    V_M0[1, 2] = V_M0[2, 1] = -1.0166893393503381444b1 - 0.028456273704916113690b3 - 0.041280298383492988198b4 - 0.13922814516201405075b5 -0.11957773256112017666b6 -0.11942677565293334109b7
    V_M0[1, 3] = V_M0[3, 1] = 0.070756429372437150463b1 - 0.18454761060241510503b2 - 0.043641631471118923470b4 + 0.24323679072077324609b5 + 0.15821270735372154440b6 + 0.16023485783647863076b7
    V_M0[1, 4] = V_M0[4, 1] = 0.22519915328913532127b1 - 0.16627487110970548953b2 + 0.027105309616486712977b3 - 0.19166461859684399091b5 - 0.076841171601990145944b6 - 0.082195869498316975759b7
    V_M0[1, 5] = V_M0[5, 1] = -0.052244034642020563167b1 + 0.044400639485098762210b2 - 0.0010239765473093878745b3 + 0.074034846453161740905b4 + 0.012416255689984968954b6  +0.071886528478926012827b5 + 0.013793629971047355034b7
    V_M0[1, 6] = V_M0[6, 1] = -0.018288968138771973527b1 +0.0095746331632217580607b2 - 0.00081057845305764042779b3 - 0.0073488455877755196984b4 + 0.010636019497239069970b5 - 0.013159670383826183824b6 - 0.021179364788387535246b7
    V_M0[1, 7] = V_M0[7, 1] = 0.0019118885633161709274b4 - 0.040681303555291499361b5 + 0.013196749810737491670b6 + 0.025572665181237836763b7
    V_M0[1, 8] = V_M0[8, 1] = 0.015596528711367857640b5 -0.0064861841573315378995b6 -0.0091103445540363197401b7
    V_M0[1, 9] = V_M0[9, 1] = 0.00055939836966298630593b6 - 0.0013848225351007963723b5 + 0.00082542416543781006633b7
    V_M0[2, 2] =              1.3063321571116676286b1 +0.25420017604573457435b3 + 0.10438978280925626095b4 + 0.66723280210321129509b5 + 0.46818193597227494411b6 + 0.46764154101958369201b7
    V_M0[2, 3] = V_M0[3, 2] = -0.090914102699924646049b1 +0.11036113131714764253b4 -1.2903975449975188870b5 -0.66396052487350447871b6 -0.66159744640052061842b7
    V_M0[2, 4] = V_M0[4, 2] = -0.28935573956534316666b1 -0.24213200040645927216b3 +1.1876702550280310277b5 +0.39565981499041363328b6 +0.38600489217558000007b7
    V_M0[2, 5] = V_M0[5, 2] = 0.067127744758037639890b1 +0.0091471926820756301800b3 -0.18721961430038080217b4 -0.13193585588531745301b6 -0.48715757368119118874b5 -0.10475163122754481381b7
    V_M0[2, 6] = V_M0[6, 2] = 0.023499279745900688694b1 +0.0072409053835651813164b3 +0.018583789963916794487b4-0.092896161339386761743b5 +0.12235132704188076670b6 +0.11135203204362950339b7
    V_M0[2, 7] = V_M0[7, 2] = -0.0048347914064469075906b4 +0.23106838326878204031b5 -0.10807741421960079917b6-0.11815617764273433354b7
    V_M0[2, 8] = V_M0[8, 2] = -0.083681414344034553537b5 +0.040934994667670546616b6 +0.042746419676364006921b7
    V_M0[2, 9] = V_M0[9, 2] = -0.0035765451326969831434b6 +0.0073893991241210786821b5 -0.0038128539914240955387b7
    V_M0[3, 3] =              0.0063271611471368738078b1 +0.11473182007158685275b2 +0.11667405542796800075b4+2.7666108082854440372b5 +1.0709206899608171042b6 +1.0131613910329730572b7
    V_M0[3, 4] = V_M0[4, 3] = 0.020137694138847972466b1 +0.10337179946308864017b2 -2.9132216211517427243b5-0.87558073434822622598b6 -0.69099571834888124265b7
    V_M0[3, 5] = V_M0[5, 3] = -0.0046717510915754628683b1 -0.027603533656377128278b2 -0.19792902986208699745b4 +0.54029853383734330523b6 +1.2391775930319110779b5 +0.26280380502473582273b7
    V_M0[3, 6] = V_M0[6, 3] = -0.0016354308669218878195b1 -0.0059524752758832596197b2 +0.019646827777442752194b4+0.32366400126390466006b5 -0.46595166932288709739b6 -0.22172727209417368594b7
    V_M0[3, 7] = V_M0[7, 3] = -0.0051113531893524745496b4 -0.53558781637747543460b5 +0.33283351044897389336b6+0.20786565911785401579b7
    V_M0[3, 8] = V_M0[8, 3] = 0.18243281741342895622b5 -0.10598160301968184459b6 -0.076451214393747111630b7
    V_M0[3, 9] = V_M0[9, 3] = 0.0092090899634437994856b6 -0.015915028188724931671b5 +0.0067059382252811321853b7
    V_M0[4, 4] =              0.064092997759871869867b1 +0.093136576388046999489b2 +0.23063676246347492291b3+3.6894403082837166203b5 +1.1905503386876088738b6 +0.59124795468888565194b7
    V_M0[4, 5] = V_M0[5, 4] = -0.014868958192656041286b1 -0.024870405993901607642b2 -0.0087129289077117541871b3 -1.2635078373718242057b6 -0.30583173978439973269b7 -1.4706919260458029548b5
    V_M0[4, 6] = V_M0[6, 4] = -0.0052051474298559556576b1 -0.0053630987475285424890b2 -0.0068971427657906095463b3-0.78575245216674501017b5 +0.22911480054237346001b7 +0.99770643562927505292b6
    V_M0[4, 7] = V_M0[7, 4] = 0.66972974880676622652b5 -0.50132473560721279390b6 -0.17951612431066454373b7
    V_M0[4, 8] = V_M0[8, 4] = -0.20229090601117515652b5 +0.14534218580636584986b6 +0.056948720204809306656b7
    V_M0[4, 9] = V_M0[9, 4] = -0.012004296184410038337b6 -0.0047769156693859238415b7 +0.016781211853795962179b5
    V_M0[5, 5] =              0.0034494550959102336252b1 +0.0066411834994278261016b2 +0.00032915450832718628585b3+0.33577217075764772000b4 +2.0964133295790264390b6 +0.23173232041831268550b7 +0.0061078257643682645765b8 +0.71091258506833766956b5
    V_M0[5, 6] = V_M0[6, 5] = 0.0012075440723041938061b1 +0.0014321166657521476075b2 +0.00026055826461832559573b3-0.033329411132516353908b4 -0.28082416973855326836b7 -0.027209080835250836084b8+0.10458654356829219874b5 -1.3484369866671155432b6
    V_M0[5, 7] = V_M0[7, 5] = 0.0086710380841746926251b4 +0.17360734113554285637b6 +0.053313621252876254126b8 -0.24249352624045263018b5 +0.15690152576785882706b7
    V_M0[5, 8] = V_M0[8, 5] = -0.086316839802171222760b6 +0.026988423604709992435b7 +0.080981941477156510853b5 -0.032764636390806391639b8
    V_M0[5, 9] = V_M0[9, 5] = 0.0074620594845308550733b6 -0.00081216403616686789496b7 +0.00055227020881270902093b8-0.0072021656571766961993b5
    V_M0[6, 6] =              0.00042272261734493450425b1 +0.00030882419443789644048b2 +0.00020625757066474306202b3+0.0033083434042009682567b4 +0.58280470164050018158b5 +0.80541742203662154736b7+0.13383632334100334433b8 +0.0055555555555555555556b9 +1.1903620718618930511b6
    V_M0[6, 7] = V_M0[7, 6] = -0.00086070442526864133026b4 -0.17480747086739049893b5 -0.31325448501150501650b8 -0.025000000000000000000b9 -0.31691663053104292713b7 -0.66916070916479291611b6
    V_M0[6, 8] = V_M0[8, 6] = 0.033546617916933521087b5 -0.33436200223869714050b7 +0.050000000000000000000b9+0.21697906098076027508b6 +0.18383632334100334433b8
    V_M0[6, 9] = V_M0[9, 6] = 0.029125184768230046430b7 +0.022790919164749163916b8 -0.030689859975187405305b6 -0.0017817995133473605962b5 -0.030555555555555555556b9
    V_M0[7, 7] =              0.00022392237357715991790b4 +0.12754377854309566738b5 +1.0116994839296081646b6 +0.96988172751725752475b8 +0.12500000000000000000b9 +0.0055555555555555555556b10 +0.48231775430312815001b7
    V_M0[7, 8] = V_M0[8, 7] = -0.037841139730330129499b5 -0.29975568851348273616b6 -0.30000000000000000000b9 - 0.025000000000000000000b10 -0.39914868674468211784b7 -0.43825448501150501650b8
    V_M0[7, 9] = V_M0[9, 7] = 0.046981462180226839339b6 -0.29668637874712374587b8 +0.050000000000000000000b10 +0.17163557041460064817b7 +0.0030693461522962583624b5 +0.17500000000000000000b9
    V_M0[8, 8] =              0.012303289427168044554b5 +0.11836475296458983325b6 +0.94105118982279433342b7 +0.95000000000000000000b9 +0.12500000000000000000b10 +0.0055555555555555555556b11 +0.56994743445211445545b8
    V_M0[8, 9] = V_M0[9, 8] = -0.023080678926719163396b6 -0.29866250537751494972b7 -0.30000000000000000000b10 -0.025000000000000000000b11 -0.0010477348605150508026b5 -0.42720908083525083608b8 - 0.42500000000000000000b9
    V_M0[9, 9] =              0.0051393702211491099770b6 +0.12477232150094220014b7 +0.95055227020881270902b8 +0.95000000000000000000b10 +0.12500000000000000000b11 +0.0055555555555555555556b12 +0.000091593624651536418269b5 +0.56111111111111111111b9
    I_M0 = (1:9) * ones(1,9)
    J_M0 = I_M0'

    V_MN = zeros(9,9)
    (b1,b2,b3,b4,b5,b6,b7,b8,b9,b10,b11,b12) = B[N+1:-1:N-10]
    V_MN[9, 9] =              0.79126675946955820939b1 + 0.29684720906380007429b2 + 0.0031855190887964290152b3 + 0.016324040425909519534b4 + 0.031603022440944150877b5 + 0.031679647480161052996b6 + 0.031485777339472539205b7
    V_MN[9, 8] = V_MN[8, 9] = -1.0166893393503381444b1 - 0.028456273704916113690b3 - 0.041280298383492988198b4 - 0.13922814516201405075b5 -0.11957773256112017666b6 -0.11942677565293334109b7
    V_MN[9, 7] = V_MN[7, 9] = 0.070756429372437150463b1 - 0.18454761060241510503b2 - 0.043641631471118923470b4 + 0.24323679072077324609b5 + 0.15821270735372154440b6 + 0.16023485783647863076b7
    V_MN[9, 6] = V_MN[6, 9] = 0.22519915328913532127b1 - 0.16627487110970548953b2 + 0.027105309616486712977b3 - 0.19166461859684399091b5 - 0.076841171601990145944b6 - 0.082195869498316975759b7
    V_MN[9, 5] = V_MN[5, 9] = -0.052244034642020563167b1 + 0.044400639485098762210b2 - 0.0010239765473093878745b3 + 0.074034846453161740905b4 + 0.012416255689984968954b6  +0.071886528478926012827b5 + 0.013793629971047355034b7
    V_MN[9, 4] = V_MN[4, 9] = -0.018288968138771973527b1 +0.0095746331632217580607b2 -0.00081057845305764042779b3 -0.0073488455877755196984b4 +0.010636019497239069970b5 -0.013159670383826183824b6-0.021179364788387535246b7
    V_MN[9, 3] = V_MN[3, 9] = 0.0019118885633161709274b4 -0.040681303555291499361b5 +0.013196749810737491670b6 +0.025572665181237836763b7
    V_MN[9, 2] = V_MN[2, 9] = 0.015596528711367857640b5 -0.0064861841573315378995b6 -0.0091103445540363197401b7
    V_MN[9, 1] = V_MN[1, 9] = 0.00055939836966298630593b6 -0.0013848225351007963723b5 +0.00082542416543781006633b7
    V_MN[8, 8] =              1.3063321571116676286b1 +0.25420017604573457435b3 +0.10438978280925626095b4 +0.66723280210321129509b5 +0.46818193597227494411b6 +0.46764154101958369201b7
    V_MN[8, 7] = V_MN[7, 8] = -0.090914102699924646049b1 +0.11036113131714764253b4 -1.2903975449975188870b5 -0.66396052487350447871b6 -0.66159744640052061842b7
    V_MN[8, 6] = V_MN[6, 8] = -0.28935573956534316666b1 -0.24213200040645927216b3 +1.1876702550280310277b5 +0.39565981499041363328b6 +0.38600489217558000007b7
    V_MN[8, 5] = V_MN[5, 8] = 0.067127744758037639890b1 +0.0091471926820756301800b3 -0.18721961430038080217b4 -0.13193585588531745301b6 -0.48715757368119118874b5 -0.10475163122754481381b7
    V_MN[8, 4] = V_MN[4, 8] = 0.023499279745900688694b1 +0.0072409053835651813164b3 +0.018583789963916794487b4-0.092896161339386761743b5 +0.12235132704188076670b6 +0.11135203204362950339b7
    V_MN[8, 3] = V_MN[3, 8] = -0.0048347914064469075906b4 +0.23106838326878204031b5 -0.10807741421960079917b6-0.11815617764273433354b7
    V_MN[8, 2] = V_MN[2, 8] = -0.083681414344034553537b5 +0.040934994667670546616b6 +0.042746419676364006921b7
    V_MN[8, 1] = V_MN[1, 8] = -0.0035765451326969831434b6 +0.0073893991241210786821b5 -0.0038128539914240955387b7
    V_MN[7, 7] =               0.0063271611471368738078b1 +0.11473182007158685275b2 +0.11667405542796800075b4+2.7666108082854440372b5 +1.0709206899608171042b6 +1.0131613910329730572b7
    V_MN[7, 6] = V_MN[6, 7] = 0.020137694138847972466b1 +0.10337179946308864017b2 -2.9132216211517427243b5-0.87558073434822622598b6 -0.69099571834888124265b7
    V_MN[7, 5] = V_MN[5, 7] = -0.0046717510915754628683b1 -0.027603533656377128278b2 -0.19792902986208699745b4 +0.54029853383734330523b6 +1.2391775930319110779b5 +0.26280380502473582273b7
    V_MN[7, 4] = V_MN[4, 7] = -0.0016354308669218878195b1 -0.0059524752758832596197b2 +0.019646827777442752194b4+0.32366400126390466006b5 -0.46595166932288709739b6 -0.22172727209417368594b7
    V_MN[7, 3] = V_MN[3, 7] = -0.0051113531893524745496b4 -0.53558781637747543460b5 +0.33283351044897389336b6+0.20786565911785401579b7
    V_MN[7, 2] = V_MN[2, 7] = 0.18243281741342895622b5 -0.10598160301968184459b6 -0.076451214393747111630b7
    V_MN[7, 1] = V_MN[1, 7] = 0.0092090899634437994856b6 -0.015915028188724931671b5 +0.0067059382252811321853b7
    V_MN[6, 6] =              0.064092997759871869867b1 +0.093136576388046999489b2 +0.23063676246347492291b3+3.6894403082837166203b5 +1.1905503386876088738b6 +0.59124795468888565194b7
    V_MN[6, 5] = V_MN[5, 6] = -0.014868958192656041286b1 -0.024870405993901607642b2 -0.0087129289077117541871b3 -1.2635078373718242057b6 -0.30583173978439973269b7 -1.4706919260458029548b5
    V_MN[6, 4] = V_MN[4, 6] = -0.0052051474298559556576b1 -0.0053630987475285424890b2 -0.0068971427657906095463b3-0.78575245216674501017b5 +0.22911480054237346001b7 +0.99770643562927505292b6
    V_MN[6, 3] = V_MN[3, 6] = 0.66972974880676622652b5 -0.50132473560721279390b6 -0.17951612431066454373b7
    V_MN[6, 2] = V_MN[2, 6] = -0.20229090601117515652b5 +0.14534218580636584986b6 +0.056948720204809306656b7
    V_MN[6, 1] = V_MN[1, 6] = -0.012004296184410038337b6 -0.0047769156693859238415b7 +0.016781211853795962179b5
    V_MN[5, 5] =              0.0034494550959102336252b1 +0.0066411834994278261016b2 +0.00032915450832718628585b3+0.33577217075764772000b4 +2.0964133295790264390b6 +0.23173232041831268550b7 +0.0061078257643682645765b8 +0.71091258506833766956b5
    V_MN[5, 4] = V_MN[4, 5] = 0.0012075440723041938061b1 +0.0014321166657521476075b2 +0.00026055826461832559573b3-0.033329411132516353908b4 -0.28082416973855326836b7 -0.027209080835250836084b8+0.10458654356829219874b5 -1.3484369866671155432b6
    V_MN[5, 3] = V_MN[3, 5] = 0.0086710380841746926251b4 +0.17360734113554285637b6 +0.053313621252876254126b8 -0.24249352624045263018b5 +0.15690152576785882706b7
    V_MN[5, 2] = V_MN[2, 5] = -0.086316839802171222760b6 +0.026988423604709992435b7 +0.080981941477156510853b5 -0.032764636390806391639b8
    V_MN[5, 1] = V_MN[1, 5] = 0.0074620594845308550733b6 -0.00081216403616686789496b7 +0.00055227020881270902093b8-0.0072021656571766961993b5
    V_MN[4, 4] =              0.00042272261734493450425b1 +0.00030882419443789644048b2 +0.00020625757066474306202b3+0.0033083434042009682567b4 +0.58280470164050018158b5 +0.80541742203662154736b7+0.13383632334100334433b8 +0.0055555555555555555556b9 +1.1903620718618930511b6
    V_MN[4, 3] = V_MN[3, 4] = -0.00086070442526864133026b4 -0.17480747086739049893b5 -0.31325448501150501650b8 -0.025000000000000000000b9 -0.31691663053104292713b7 -0.66916070916479291611b6
    V_MN[4, 2] = V_MN[2, 4] = 0.033546617916933521087b5 -0.33436200223869714050b7 +0.050000000000000000000b9+0.21697906098076027508b6 +0.18383632334100334433b8
    V_MN[4, 1] = V_MN[1, 4] = 0.029125184768230046430b7 +0.022790919164749163916b8 -0.030689859975187405305b6 -0.0017817995133473605962b5 -0.030555555555555555556b9
    V_MN[3, 3] =              0.00022392237357715991790b4 +0.12754377854309566738b5 +1.0116994839296081646b6 +0.96988172751725752475b8 +0.12500000000000000000b9 +0.0055555555555555555556b10 +0.48231775430312815001b7
    V_MN[3, 2] = V_MN[2, 3] = -0.037841139730330129499b5 -0.29975568851348273616b6 -0.30000000000000000000b9 - 0.025000000000000000000b10 -0.39914868674468211784b7 -0.43825448501150501650b8
    V_MN[3, 1] = V_MN[1, 3] = 0.046981462180226839339b6 -0.29668637874712374587b8 +0.050000000000000000000b10 +0.17163557041460064817b7 +0.0030693461522962583624b5 +0.17500000000000000000b9
    V_MN[2, 2] =               0.012303289427168044554b5 +0.11836475296458983325b6 +0.94105118982279433342b7 +0.95000000000000000000b9 +0.12500000000000000000b10 +0.0055555555555555555556b11 +0.56994743445211445545b8
    V_MN[2, 1] = V_MN[1, 2] = -0.023080678926719163396b6 -0.29866250537751494972b7 -0.30000000000000000000b10 -0.025000000000000000000b11 -0.0010477348605150508026b5 -0.42720908083525083608b8 - 0.42500000000000000000b9
    V_MN[1, 1] =              0.0051393702211491099770b6 +0.12477232150094220014b7 +0.95055227020881270902b8 +0.95000000000000000000b10 +0.12500000000000000000b11 +0.0055555555555555555556b12 +0.000091593624651536418269b5 +0.56111111111111111111b9

    I_MN = (N-7:N+1) * ones(1,9)
    J_MN = I_MN'

    I_M = [10:N-5;
           10:N-6;
           10:N-7;
           10:N-8;
           9:N-8;
           8:N-8;
           7:N-8] 
    J_M = [7:N-8;
           8:N-8;
           9:N-8;
           10:N-8;
           10:N-7;
           10:N-6;
           10:N-5] 
    V_M =  [(-(11/360)B[(10:N-5).-3] + (1/40)B[(10:N-5).-2] + (1/40)B[(10:N-5).-1] - (11/360)B[(10:N-5)]);
            (+(1/20)B[(10:N-6).-3] + (7/40)B[(10:N-6).-2] - (3/10)B[(10:N-6).-1] + (7/40)B[(10:N-6)] + (1/20)B[(10:N-6).+1]);
            (-(1/40)B[(10:N-7).-3] -(3/10)B[(10:N-7).-2] - (17/40)B[(10:N-7).-1] - (17/40)B[(10:N-7)] - (3/10)B[(10:N-7).+1] - (1/40)B[(10:N-7).+2]);
            (+(1/180)B[(10:N-8).-3] +(1/8)B[(10:N-8).-2] + (19/20)B[(10:N-8).-1] + (101/180)B[(10:N-8)] + (19/20)B[(10:N-8).+1] + (1/8)B[(10:N-8).+2]+ (1/180)B[(10:N-8).+3]);
            (-(1/40)B[(9:N-8).-2] - (3/10)B[(9:N-8).-1] - (17/40)B[(9:N-8)] - (17/40)B[(9:N-8).+1] - (3/10)B[(9:N-8).+2] - (1/40)B[(9:N-8).+3]);
            (+(1/20)B[(8:N-8).-1] + (7/40)B[(8:N-8)] - (3/10)B[(8:N-8).+1] + (7/40)B[(8:N-8).+2]+ (1/20)B[(8:N-8).+3] );
            (-(11/360)B[(7:N-8)] + (1/40)B[(7:N-8).+1] + (1/40)B[(7:N-8).+2] - (11/360)B[(7:N-8).+3]);
           ]

    M = sparse([I_M0[:];I_M[:];I_MN[:]],
               [J_M0[:];J_M[:];J_MN[:]],
               [V_M0[:];V_M[:];V_MN[:]])

  else
    error(string("Operators for order ", p, " are not implemented"))
  end

  bm = length(bhinv)
  Np = N+1

  if(Np < 2*bm)
    error("Grid not big enough to support the operator. Grid must have N >= ", max(bn,2*bm))
  end

  h = (xc[2] - xc[1]) / N
  M = M/h
  @assert h > 0
  H_I = 1:Np
  H_V = ones(Np)
  H_V[1:bm] = bhinv[:]
  H_V[Np-bm+1:Np] = bhinv[end:-1:1]
  HI = sparse(H_I, H_I, H_V / h)
  H  = sparse(H_I, H_I, h ./ H_V)

  S0 = sparse(ones(length(BS)), 1:length(BS), -B[1]*BS[:]/h, N+1, N+1);
  SN = sparse((N+1) * ones(length(BS)), (N+1):-1:(N+2-length(BS)),
              B[N+1]*BS[:]/h, N+1, N+1);
  D = HI * (-M + SN - S0)

  r = Compat.range(xc[1], stop=xc[2], length=N+1)

  BS = SN - S0
  (D, BS, HI, H, r)
end
=#

